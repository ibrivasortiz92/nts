/////////////////////////////////////////////////////////////////////// SOLUTION SECTION => VARIABLES
/////////////////////////////////////////////////////////////////////////////////////////////////////
let QUAD;
let TOL = 0.00001;
let METH = 'dd_method';

////////////////////////////////////////////////////////////// SOLUTION SECTION => INITIALIZATION
/////////////////////////////////////////////////////////////////////////////////////////////////////
function solution_section_init() {
  // UPDATE QUADRATURE, TOLERANCE AND METHOD
  solution_quadrature_init();
  solution_tolerance_init();
  solution_method_init();
}

////////////////////////////////////////////////////////////////////// SOLUTION SECTION => QUADRATURE
/////////////////////////////////////////////////////////////////////////////////////////////////////
document.getElementById('solution-section__quadrature--select-btn').onchange = (
  event
) => {
  solution_quadrature_load(event.target.selectedIndex);

  // RESET RESULTS
  results_reset();
};

// LOAD QUADRATURE
function solution_quadrature_load(option) {
  if (option == 1) {
    QUAD = {
      miu: [
        5.7735026918962573e-1, -5.7735026918962573e-1, -5.7735026918962573e-1,
        5.7735026918962573e-1,
      ],
      theta: [
        5.7735026918962573e-1, 5.7735026918962573e-1, -5.7735026918962573e-1,
        -5.7735026918962573e-1,
      ],
      w: [1.0, 1.0, 1.0, 1.0],
    };
    solution_quadrature_display();
  } else if (option == 2) {
    QUAD = {
      miu: [
        8.6889030072220119e-1, 3.5002117458154069e-1, 3.5002117458154069e-1,
        -8.6889030072220119e-1, -3.5002117458154069e-1, -3.5002117458154069e-1,
        -8.6889030072220119e-1, -3.5002117458154069e-1, -3.5002117458154069e-1,
        8.6889030072220119e-1, 3.5002117458154069e-1, 3.5002117458154069e-1,
      ],
      theta: [
        3.5002117458154069e-1, 8.6889030072220119e-1, 3.5002117458154069e-1,
        3.5002117458154069e-1, 8.6889030072220119e-1, 3.5002117458154069e-1,
        -3.5002117458154069e-1, -8.6889030072220119e-1, -3.5002117458154069e-1,
        -3.5002117458154069e-1, -8.6889030072220119e-1, -3.5002117458154069e-1,
      ],
      w: [
        3.3333333333333331e-1, 3.3333333333333331e-1, 3.3333333333333331e-1,
        3.3333333333333331e-1, 3.3333333333333331e-1, 3.3333333333333331e-1,
        3.3333333333333331e-1, 3.3333333333333331e-1, 3.3333333333333331e-1,
        3.3333333333333331e-1, 3.3333333333333331e-1, 3.3333333333333331e-1,
      ],
    };
    solution_quadrature_display();
  } else if (option == 3) {
    QUAD = {
      miu: [
        9.2618093551748915e-1, 6.815077265365469e-1, 2.6663540151670473e-1,
        6.815077265365469e-1, 2.6663540151670473e-1, 2.6663540151670473e-1,
        -9.2618093551748915e-1, -6.815077265365469e-1, -2.6663540151670473e-1,
        -6.815077265365469e-1, -2.6663540151670473e-1, -2.6663540151670473e-1,
        -9.2618093551748915e-1, -6.815077265365469e-1, -2.6663540151670473e-1,
        -6.815077265365469e-1, -2.6663540151670473e-1, -2.6663540151670473e-1,
        9.2618093551748915e-1, 6.815077265365469e-1, 2.6663540151670473e-1,
        6.815077265365469e-1, 2.6663540151670473e-1, 2.6663540151670473e-1,
      ],
      theta: [
        2.6663540151670473e-1, 6.815077265365469e-1, 9.2618093551748915e-1,
        2.6663540151670473e-1, 6.815077265365469e-1, 2.6663540151670473e-1,
        2.6663540151670473e-1, 6.815077265365469e-1, 9.2618093551748915e-1,
        2.6663540151670473e-1, 6.815077265365469e-1, 2.6663540151670473e-1,
        -2.6663540151670473e-1, -6.815077265365469e-1, -9.2618093551748915e-1,
        -2.6663540151670473e-1, -6.815077265365469e-1, -2.6663540151670473e-1,
        -2.6663540151670473e-1, -6.815077265365469e-1, -9.2618093551748915e-1,
        -2.6663540151670473e-1, -6.815077265365469e-1, -2.6663540151670473e-1,
      ],
      w: [
        1.7612613086338344e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.572072024699499e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.7612613086338344e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.572072024699499e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.7612613086338344e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.572072024699499e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.7612613086338344e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
        1.572072024699499e-1, 1.572072024699499e-1, 1.7612613086338344e-1,
      ],
    };
    solution_quadrature_display();
  } else if (option == 4) {
    QUAD = {
      miu: [
        9.5118973121134187e-1, 7.867957924694432e-1, 5.7735026918962573e-1,
        2.1821789023599239e-1, 7.867957924694432e-1, 5.7735026918962573e-1,
        2.1821789023599239e-1, 5.7735026918962573e-1, 2.1821789023599239e-1,
        2.1821789023599239e-1, -9.5118973121134187e-1, -7.867957924694432e-1,
        -5.7735026918962573e-1, -2.1821789023599239e-1, -7.867957924694432e-1,
        -5.7735026918962573e-1, -2.1821789023599239e-1, -5.7735026918962573e-1,
        -2.1821789023599239e-1, -2.1821789023599239e-1, -9.5118973121134187e-1,
        -7.867957924694432e-1, -5.7735026918962573e-1, -2.1821789023599239e-1,
        -7.867957924694432e-1, -5.7735026918962573e-1, -2.1821789023599239e-1,
        -5.7735026918962573e-1, -2.1821789023599239e-1, -2.1821789023599239e-1,
        9.5118973121134187e-1, 7.867957924694432e-1, 5.7735026918962573e-1,
        2.1821789023599239e-1, 7.867957924694432e-1, 5.7735026918962573e-1,
        2.1821789023599239e-1, 5.7735026918962573e-1, 2.1821789023599239e-1,
        2.1821789023599239e-1,
      ],
      theta: [
        2.1821789023599239e-1, 5.7735026918962573e-1, 7.867957924694432e-1,
        9.5118973121134187e-1, 2.1821789023599239e-1, 5.7735026918962573e-1,
        7.867957924694432e-1, 2.1821789023599239e-1, 5.7735026918962573e-1,
        2.1821789023599239e-1, 2.1821789023599239e-1, 5.7735026918962573e-1,
        7.867957924694432e-1, 9.5118973121134187e-1, 2.1821789023599239e-1,
        5.7735026918962573e-1, 7.867957924694432e-1, 2.1821789023599239e-1,
        5.7735026918962573e-1, 2.1821789023599239e-1, -2.1821789023599239e-1,
        -5.7735026918962573e-1, -7.867957924694432e-1, -9.5118973121134187e-1,
        -2.1821789023599239e-1, -5.7735026918962573e-1, -7.867957924694432e-1,
        -2.1821789023599239e-1, -5.7735026918962573e-1, -2.1821789023599239e-1,
        -2.1821789023599239e-1, -5.7735026918962573e-1, -7.867957924694432e-1,
        -9.5118973121134187e-1, -2.1821789023599239e-1, -5.7735026918962573e-1,
        -7.867957924694432e-1, -2.1821789023599239e-1, -5.7735026918962573e-1,
        -2.1821789023599239e-1,
      ],
      w: [
        1.2098765432098765e-1, 9.0740740740740747e-2, 9.0740740740740747e-2,
        1.2098765432098765e-1, 9.0740740740740747e-2, 9.2592592592592587e-2,
        9.0740740740740747e-2, 9.0740740740740747e-2, 9.0740740740740747e-2,
        1.2098765432098765e-1, 1.2098765432098765e-1, 9.0740740740740747e-2,
        9.0740740740740747e-2, 1.2098765432098765e-1, 9.0740740740740747e-2,
        9.2592592592592587e-2, 9.0740740740740747e-2, 9.0740740740740747e-2,
        9.0740740740740747e-2, 1.2098765432098765e-1, 1.2098765432098765e-1,
        9.0740740740740747e-2, 9.0740740740740747e-2, 1.2098765432098765e-1,
        9.0740740740740747e-2, 9.2592592592592587e-2, 9.0740740740740747e-2,
        9.0740740740740747e-2, 9.0740740740740747e-2, 1.2098765432098765e-1,
        1.2098765432098765e-1, 9.0740740740740747e-2, 9.0740740740740747e-2,
        1.2098765432098765e-1, 9.0740740740740747e-2, 9.2592592592592587e-2,
        9.0740740740740747e-2, 9.0740740740740747e-2, 9.0740740740740747e-2,
        1.2098765432098765e-1,
      ],
    };
    solution_quadrature_display();
  } else if (option == 5) {
    QUAD = {
      miu: [
        9.6349098111046849e-1, 8.3975996223668481e-1, 6.9431888759438432e-1,
        5.0888175558261894e-1, 1.8932132647801048e-1, 8.3975996223668481e-1,
        6.9431888759438432e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        6.9431888759438432e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        5.0888175558261894e-1, 1.8932132647801048e-1, 1.8932132647801048e-1,
        -9.6349098111046849e-1, -8.3975996223668481e-1, -6.9431888759438432e-1,
        -5.0888175558261894e-1, -1.8932132647801048e-1, -8.3975996223668481e-1,
        -6.9431888759438432e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
        -6.9431888759438432e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
        -5.0888175558261894e-1, -1.8932132647801048e-1, -1.8932132647801048e-1,
        -9.6349098111046849e-1, -8.3975996223668481e-1, -6.9431888759438432e-1,
        -5.0888175558261894e-1, -1.8932132647801048e-1, -8.3975996223668481e-1,
        -6.9431888759438432e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
        -6.9431888759438432e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
        -5.0888175558261894e-1, -1.8932132647801048e-1, -1.8932132647801048e-1,
        9.6349098111046849e-1, 8.3975996223668481e-1, 6.9431888759438432e-1,
        5.0888175558261894e-1, 1.8932132647801048e-1, 8.3975996223668481e-1,
        6.9431888759438432e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        6.9431888759438432e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        5.0888175558261894e-1, 1.8932132647801048e-1, 1.8932132647801048e-1,
      ],
      theta: [
        1.8932132647801048e-1, 5.0888175558261894e-1, 6.9431888759438432e-1,
        8.3975996223668481e-1, 9.6349098111046849e-1, 1.8932132647801048e-1,
        5.0888175558261894e-1, 6.9431888759438432e-1, 8.3975996223668481e-1,
        1.8932132647801048e-1, 5.0888175558261894e-1, 6.9431888759438432e-1,
        1.8932132647801048e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        1.8932132647801048e-1, 5.0888175558261894e-1, 6.9431888759438432e-1,
        8.3975996223668481e-1, 9.6349098111046849e-1, 1.8932132647801048e-1,
        5.0888175558261894e-1, 6.9431888759438432e-1, 8.3975996223668481e-1,
        1.8932132647801048e-1, 5.0888175558261894e-1, 6.9431888759438432e-1,
        1.8932132647801048e-1, 5.0888175558261894e-1, 1.8932132647801048e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -6.9431888759438432e-1,
        -8.3975996223668481e-1, -9.6349098111046849e-1, -1.8932132647801048e-1,
        -5.0888175558261894e-1, -6.9431888759438432e-1, -8.3975996223668481e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -6.9431888759438432e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -6.9431888759438432e-1,
        -8.3975996223668481e-1, -9.6349098111046849e-1, -1.8932132647801048e-1,
        -5.0888175558261894e-1, -6.9431888759438432e-1, -8.3975996223668481e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -6.9431888759438432e-1,
        -1.8932132647801048e-1, -5.0888175558261894e-1, -1.8932132647801048e-1,
      ],
      w: [
        8.9303147984356721e-2, 7.2529151712365528e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 8.9303147984356721e-2, 7.2529151712365528e-2,
        5.3928114487836923e-2, 5.3928114487836923e-2, 7.2529151712365528e-2,
        4.5043767436408637e-2, 5.3928114487836923e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 7.2529151712365528e-2, 8.9303147984356721e-2,
        8.9303147984356721e-2, 7.2529151712365528e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 8.9303147984356721e-2, 7.2529151712365528e-2,
        5.3928114487836923e-2, 5.3928114487836923e-2, 7.2529151712365528e-2,
        4.5043767436408637e-2, 5.3928114487836923e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 7.2529151712365528e-2, 8.9303147984356721e-2,
        8.9303147984356721e-2, 7.2529151712365528e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 8.9303147984356721e-2, 7.2529151712365528e-2,
        5.3928114487836923e-2, 5.3928114487836923e-2, 7.2529151712365528e-2,
        4.5043767436408637e-2, 5.3928114487836923e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 7.2529151712365528e-2, 8.9303147984356721e-2,
        8.9303147984356721e-2, 7.2529151712365528e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 8.9303147984356721e-2, 7.2529151712365528e-2,
        5.3928114487836923e-2, 5.3928114487836923e-2, 7.2529151712365528e-2,
        4.5043767436408637e-2, 5.3928114487836923e-2, 4.5043767436408637e-2,
        7.2529151712365528e-2, 7.2529151712365528e-2, 8.9303147984356721e-2,
      ],
    };
    solution_quadrature_display();
  } else if (option == 6) {
    QUAD = {
      miu: [
        9.7163771925135833e-1, 8.7227054302572149e-1, 7.6002101483366402e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        8.7227054302572149e-1, 7.6002101483366402e-1, 6.2801909664213085e-1,
        4.5954763464259468e-1, 1.6721265282271328e-1, 7.6002101483366402e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        4.5954763464259468e-1, 1.6721265282271328e-1, 1.6721265282271328e-1,
        -9.7163771925135833e-1, -8.7227054302572149e-1, -7.6002101483366402e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -8.7227054302572149e-1, -7.6002101483366402e-1, -6.2801909664213085e-1,
        -4.5954763464259468e-1, -1.6721265282271328e-1, -7.6002101483366402e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -4.5954763464259468e-1, -1.6721265282271328e-1, -1.6721265282271328e-1,
        -9.7163771925135833e-1, -8.7227054302572149e-1, -7.6002101483366402e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -8.7227054302572149e-1, -7.6002101483366402e-1, -6.2801909664213085e-1,
        -4.5954763464259468e-1, -1.6721265282271328e-1, -7.6002101483366402e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -6.2801909664213085e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -4.5954763464259468e-1, -1.6721265282271328e-1, -1.6721265282271328e-1,
        9.7163771925135833e-1, 8.7227054302572149e-1, 7.6002101483366402e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        8.7227054302572149e-1, 7.6002101483366402e-1, 6.2801909664213085e-1,
        4.5954763464259468e-1, 1.6721265282271328e-1, 7.6002101483366402e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        6.2801909664213085e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        4.5954763464259468e-1, 1.6721265282271328e-1, 1.6721265282271328e-1,
      ],
      theta: [
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        7.6002101483366402e-1, 8.7227054302572149e-1, 9.7163771925135833e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        7.6002101483366402e-1, 8.7227054302572149e-1, 1.6721265282271328e-1,
        4.5954763464259468e-1, 6.2801909664213085e-1, 7.6002101483366402e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        7.6002101483366402e-1, 8.7227054302572149e-1, 9.7163771925135833e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        7.6002101483366402e-1, 8.7227054302572149e-1, 1.6721265282271328e-1,
        4.5954763464259468e-1, 6.2801909664213085e-1, 7.6002101483366402e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 6.2801909664213085e-1,
        1.6721265282271328e-1, 4.5954763464259468e-1, 1.6721265282271328e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -7.6002101483366402e-1, -8.7227054302572149e-1, -9.7163771925135833e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -7.6002101483366402e-1, -8.7227054302572149e-1, -1.6721265282271328e-1,
        -4.5954763464259468e-1, -6.2801909664213085e-1, -7.6002101483366402e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -7.6002101483366402e-1, -8.7227054302572149e-1, -9.7163771925135833e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -7.6002101483366402e-1, -8.7227054302572149e-1, -1.6721265282271328e-1,
        -4.5954763464259468e-1, -6.2801909664213085e-1, -7.6002101483366402e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -6.2801909664213085e-1,
        -1.6721265282271328e-1, -4.5954763464259468e-1, -1.6721265282271328e-1,
      ],
      w: [
        7.076258997009105e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        5.5881101564888805e-2, 5.0281901060057116e-2, 2.585129165575039e-2,
        5.0281901060057116e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        2.585129165575039e-2, 2.585129165575039e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.0281901060057116e-2, 3.7337673758828585e-2,
        5.5881101564888805e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        7.076258997009105e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        5.5881101564888805e-2, 5.0281901060057116e-2, 2.585129165575039e-2,
        5.0281901060057116e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        2.585129165575039e-2, 2.585129165575039e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.0281901060057116e-2, 3.7337673758828585e-2,
        5.5881101564888805e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        7.076258997009105e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        5.5881101564888805e-2, 5.0281901060057116e-2, 2.585129165575039e-2,
        5.0281901060057116e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        2.585129165575039e-2, 2.585129165575039e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.0281901060057116e-2, 3.7337673758828585e-2,
        5.5881101564888805e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        7.076258997009105e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
        5.5881101564888805e-2, 5.0281901060057116e-2, 2.585129165575039e-2,
        5.0281901060057116e-2, 5.5881101564888805e-2, 3.7337673758828585e-2,
        2.585129165575039e-2, 2.585129165575039e-2, 3.7337673758828585e-2,
        3.7337673758828585e-2, 5.0281901060057116e-2, 3.7337673758828585e-2,
        5.5881101564888805e-2, 5.5881101564888805e-2, 7.076258997009105e-2,
      ],
    };
    solution_quadrature_display();
  } else QUAD = undefined;
}

// RESET QUADRATURE
function solution_quadrature_reset() {
  let input = document.getElementById(
    'solution-section__quadrature--select-btn'
  );
  input.selectedIndex = 0;
  QUAD = undefined;
}

// INITIALIZE QUADRATURE
function solution_quadrature_init() {
  let input = document.getElementById(
    'solution-section__quadrature--select-btn'
  );
  if (QUAD != undefined) {
    if (QUAD['miu'].length == 4) input.selectedIndex = 1;
    else if (QUAD['miu'].length == 12) input.selectedIndex = 2;
    else if (QUAD['miu'].length == 24) input.selectedIndex = 3;
    else if (QUAD['miu'].length == 40) input.selectedIndex = 4;
    else if (QUAD['miu'].length == 60) input.selectedIndex = 5;
    else if (QUAD['miu'].length == 84) input.selectedIndex = 6;
  }
}

// DISPLAY QUADRATURE
function solution_quadrature_display() {
  // WARNINGS
  if (QUAD == undefined) {
    console.log('NO QUADRATURE SELECTED');
    return;
  }

  document.getElementById('initial_img').style.display = 'none';
  if (document.getElementById('canvas_geom'))
    document.getElementById('canvas_geom').remove();
  if (document.getElementById('canvas_quad'))
    document.getElementById('canvas_quad').remove();
  if (document.getElementById('results__picture'))
    document.getElementById('results__picture').remove();

  // CREATE CANVAS
  let monitor = document.querySelector('#main-content__layout--monitor');
  let canvas = document.createElement('canvas');
  canvas.id = 'canvas_quad';
  canvas.width = monitor.offsetWidth - 50;
  canvas.height = monitor.offsetHeight - 50;

  // CANVAS SETTINGS
  let LEN = Math.min(canvas.height - 50, canvas.width - 50);
  let X_MARGIN = (canvas.width - LEN) / 2;
  let Y_MARGIN = (canvas.height - LEN) / 2;

  // CANVAS CONTENT
  if (canvas.getContext) {
    let ctx = canvas.getContext('2d');
    let x0, xlen, y0, ylen;

    // COORDINATE SYSTEM
    ctx.beginPath();
    x0 = X_MARGIN;
    xlen = LEN;
    y0 = (2 * Y_MARGIN + LEN) / 2;
    ctx.moveTo(x0, y0);
    ctx.lineTo(x0 + xlen, y0);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x0 + xlen + 5, y0);
    ctx.lineTo(x0 + xlen, y0 + 2);
    ctx.lineTo(x0 + xlen, y0 - 2);
    ctx.fill();
    ctx.font = '10px Times New Roman';
    ctx.fillStyle = 'Black';
    ctx.fillText('X', x0 + xlen + 10, y0 + 3);

    ctx.beginPath();
    x0 = (2 * X_MARGIN + LEN) / 2;
    y0 = Y_MARGIN;
    ylen = LEN;
    ctx.moveTo(x0, y0);
    ctx.lineTo(x0, y0 + ylen);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x0, y0 - 5);
    ctx.lineTo(x0 + 2, y0);
    ctx.lineTo(x0 - 2, y0);
    ctx.fill();
    ctx.font = '10px Times New Roman';
    ctx.fillStyle = 'Black';
    ctx.fillText('Y', x0 - 3, y0 - 10);

    // QUADRATURE
    let dx1, dy1, dx2, dy2;
    for (let m = 0; m < QUAD.w.length; m++) {
      x0 = (2 * X_MARGIN + LEN) / 2;
      xlen = (QUAD['miu'][m] * LEN) / 2;
      y0 = (2 * Y_MARGIN + LEN) / 2;
      ylen = (QUAD['theta'][m] * LEN) / 2;
      ctx.beginPath();
      ctx.moveTo(x0, y0);
      ctx.lineTo(x0 + xlen, y0 + ylen);
      ctx.stroke();

      dx1 = QUAD['miu'][m] * 5;
      dy1 = QUAD['theta'][m] * 5;
      if (Math.abs(QUAD['miu'][m]) < Math.abs(QUAD['theta'][m])) {
        dx2 = 2;
        dy2 = (QUAD['miu'][m] * dx2) / QUAD['theta'][m];
      } else {
        dy2 = 2;
        dx2 = (QUAD['theta'][m] * dy2) / QUAD['miu'][m];
      }
      ctx.beginPath();
      ctx.moveTo(x0 + xlen + 2 * dx1, y0 + ylen + 2 * dy1);
      ctx.lineTo(x0 + xlen + dx2, y0 + ylen - dy2);
      ctx.lineTo(x0 + xlen - dx2, y0 + ylen + dy2);
      ctx.fill();
    }
  }
  monitor.append(canvas);
}

/////////////////////////////////////////////////////////////// SOLUTION SECTION => STOPPING CRITERIA
/////////////////////////////////////////////////////////////////////////////////////////////////////
document.getElementById('solution-section__stop-criteria--input').onchange =
  function () {
    let err = document.getElementById('solution-section__stop-criteria--msg');
    err.className = '';
    err.innerHTML = '';
    this.classList.remove('is-invalid');
    let tol = this.value * 1;
    if (isNaN(tol) || tol > 0.0001) {
      this.classList.add('is-invalid');
      err.className = 'invalid-feedback';
      err.innerHTML = 'Number >= 0.0001';
      return;
    }
    TOL = tol;

    // RESET RESULTS
    results_reset();
  };

// INITIALIZE TOLERANCE
function solution_tolerance_init() {
  let tol = document.getElementById('solution-section__stop-criteria--input');
  if (TOL != undefined) tol.value = TOL;
}

/////////////////////////////////////////////////////////////// SOLUTION SECTION => CALCULATE PROCESS
/////////////////////////////////////////////////////////////////////////////////////////////////////
function solution_method_init() {
  let options = document.querySelectorAll("input[name='scheme']");
  if (METH == undefined) METH = 'dd_method';
  options.forEach((option) => {
    if (option.id == METH) {
      option.checked = true;
    }
  });
}

document.getElementById('solution-section__calculate--btn').onclick =
  function () {
    // SELECT METHOD
    let options = document.querySelectorAll("input[name='scheme']");
    options.forEach((option) => {
      if (option.checked) {
        selected = option.id;
        METH = selected;
      }
    });

    // SAVE OPTION
    let save = false;

    // CPU OPTION
    let cpu_time = false;
    if (
      document.getElementById('solution-section__cpu-option--input-cpu').checked
    )
      cpu_time = true;

    // CALCULATION
    if (solution_data_validator(save)) {
      document.getElementById('solution-section__running-btn').click();
      setTimeout(function () {
        // DEFINE A NAME AND NOTIFICATION
        let name = METH,
          notification = false;
        if (save) {
          name = document.getElementById(
            'solution-section__save-problem--save-option__input'
          ).value;
          if (name == '') name = METH;
          if (
            document.getElementById(
              'solution-section__save-problem--input-notification'
            ).checked
          ) {
            notification = true;
          }
        }

        // SEND TO CALCULATE
        let csrftoken = document.querySelector(
          '[name=csrfmiddlewaretoken]'
        ).value;
        let data = {
          Name: name,
          Save: save,
          Notification: notification,
          cpu_loop: cpu_time,
          ZN: ZN,
          ZON: ZON,
          XREG: XREG,
          XDOM: XDOM,
          YREG: YREG,
          YDOM: YDOM,
          ZMAP: ZMAP,
          QMAP: QMAP,
          BC: BC,
          QUAD: QUAD,
          TOL: TOL,
          METH: METH,
        };
        fetch('/ntc', {
          method: 'POST',
          headers: {'X-CSRFToken': csrftoken},
          mode: 'same-origin',
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data['STATUS'] == 0) {
              // LOAD RESULTS
              ITER = data['ITER'];
              CPU = data['CPU'];
              MFLUX = data['MFLUX'];
              MFLOW = data['MFLOW'];
              XFLOW = data['XFLOW'];
              YFLOW = data['YFLOW'];

              // PLOT RESULTS
              results_plot('plot_flux');

              // DISPLAY RESULTS IN CONSOLE
              console_process_cmd('clear');
              console_process_cmd('results');
              console_process_cmd('calculation_done');
            } else {
              // DISPLAY ERROR IN CONSOLE
              console_process_cmd('clear');
              console_process_error(`${data['STATUS']}`);
            }
            document.getElementById('modal-run__close-calculation').click();
          });
      }, 1000);
    }
  };

// VALIDATE SOLUTION FUNCTION
function solution_data_validator(save) {
  if (save) {
    let input = document.getElementById(
      'solution-section__save-problem--save-option__input'
    );
    let name = input.value;
    input.classList.remove('is-invalid');
    let err = document.getElementById(
      'solution-section__save-problem--save-option__msg'
    );
    err.className = '';
    err.innerHTML = '';

    // NAME VALIDATION
    if (name == '') {
      input.classList.add('is-invalid');
      err.className = 'invalid-feedback';
      err.innerHTML = 'Name file required';
      return false;
    }
  }

  // DATA VALIDATION
  if (
    ZN == 0 ||
    XREG == 0 ||
    YREG == 0 ||
    ZMAP == undefined ||
    QMAP == undefined
  ) {
    console_process_error('calculation');
    return false;
  }
  if (QMAP == undefined) {
    console_process_error('quadrature');
    return false;
  }

  return true;
}

